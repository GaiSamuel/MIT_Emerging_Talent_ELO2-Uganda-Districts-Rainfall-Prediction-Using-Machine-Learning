<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uganda District Rainfall Forecast 2025-2026</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <style>
    body {
      background-color: #0f172a;
      color: #e2e8f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    .rain-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      background: linear-gradient(to bottom, #0f172a, #1e293b);
    }

    .drop {
      position: absolute;
      width: 2px;
      height: 15px;
      background: rgba(148, 163, 184, 0.2);
      animation: fall linear infinite;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh);
      }
    }

    .glass-panel {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1rem;
    }

    /* --- INTERACTIVE MAP STYLING --- */
    #map {
      background: #1e293b;
      border-radius: 0.75rem;
      z-index: 0;
      /* Removed pointer-events: none to enable interaction */
      /* Removed grayscale filter for better visibility */
    }

    /* Customize Leaflet Popup to match dark theme */
    .leaflet-popup-content-wrapper {
      background: rgba(15, 23, 42, 0.9);
      color: #e2e8f0;
      border: 1px solid #3b82f6;
    }

    .leaflet-popup-tip {
      background: #3b82f6;
    }
  </style>
</head>

<body>

  <div class="rain-container" id="rain"></div>

  <div class="container mx-auto px-4 py-8 max-w-6xl min-h-screen flex flex-col">

    <!-- HEADER -->
    <header class="text-center mb-12 animate-fade-in-down">
      <h1 class="text-4xl md:text-6xl font-bold mb-4">
        <span>ðŸ‡ºðŸ‡¬</span>
        <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-black via-yellow-400 to-red-600 pb-2 drop-shadow-[0_1px_1px_rgba(255,255,255,0.5)]">
          Uganda Rainfall Outlook
        </span>
      </h1>
      <p class="text-xl text-gray-300">District-level Rainfall Forecasts (Nov 2025 - Dec 2026)</p>
    </header>

    <!-- PROJECT OVERVIEW SECTION -->
    <section class="mb-16 glass-panel p-8 animate-fade-in-down">
      <div class="flex items-center gap-3 mb-6">
        <i data-lucide="info" class="w-8 h-8 text-blue-400"></i>
        <h2 class="text-3xl font-bold text-white">About This Project</h2>
      </div>

      <div class="grid md:grid-cols-2 gap-8">
        <div class="space-y-4 text-gray-300 leading-relaxed">
          <p>
            <strong class="text-blue-300">The Challenge:</strong> Uganda's economy and food security rely heavily on
            rain-fed agriculture. However, climate variability creates uncertainty for farmers, leading to risks like
            crop failure from unexpected droughts or loss from flash floods.
          </p>
          <p>
            <strong class="text-blue-300">Our Solution:</strong> We utilized 44 years of historical climate data (ERA5 &
            CHIRPS) to train a machine learning model (Random Forest). This model predicts monthly rainfall for every
            single district in Uganda for the next 14 months.
          </p>
          <p>
            <strong class="text-blue-300">Why Trust It?</strong> Our model correctly reproduces Uganda's two rainy
            seasons (MAM & SON) and accounts for regional differences, performing <strong>36% better</strong> than
            standard historical averages.
          </p>
        </div>

        <!-- Visuals -->
        <div class="grid grid-cols-2 gap-4">

          <!-- National Trend -->
          <div
            class="bg-slate-800/50 rounded-lg p-2 border border-slate-600 flex flex-col items-center text-center group hover:scale-105 transition duration-300">
            <div class="w-full h-24 rounded mb-2 overflow-hidden">
              <img src="images/national_rainfall_trend.png" class="w-full h-full object-cover">
            </div>
            <p class="text-xs text-gray-400 font-semibold">National Trend</p>
            <p class="text-[10px] text-gray-500">Captures Bimodal Seasonality</p>
          </div>

          <!-- Spatial Analysis -->
          <div
            class="bg-slate-800/50 rounded-lg p-2 border border-slate-600 flex flex-col items-center text-center group hover:scale-105 transition duration-300">
            <div class="w-full h-24 rounded mb-2 overflow-hidden">
              <img src="images/wettest_vs_driest_districts.png" class="w-full h-full object-cover">
            </div>
            <p class="text-xs text-gray-400 font-semibold">Spatial Analysis</p>
            <p class="text-[10px] text-gray-500">Wettest vs. Driest Districts</p>
          </div>

          <!-- Regional Trends -->
          <div
            class="bg-slate-800/50 rounded-lg p-2 border border-slate-600 flex flex-col items-center text-center group hover:scale-105 transition duration-300">
            <div class="w-full h-24 rounded mb-2 overflow-hidden">
              <img src="images/regional_rainfall_trend.png" class="w-full h-full object-cover">
            </div>
            <p class="text-xs text-gray-400 font-semibold">Regional Trends</p>
            <p class="text-[10px] text-gray-500">North, Central, West and East</p>
          </div>

          <div
            class="bg-slate-800/50 rounded-lg p-2 border border-slate-600 flex flex-col items-center text-center group hover:scale-105 transition duration-300">
            <div
              class="w-full h-24 bg-gradient-to-br from-purple-900 to-slate-800 rounded mb-2 flex items-center justify-center">
              <i data-lucide="check-circle" class="w-8 h-8 text-purple-400"></i>
            </div>
            <p class="text-xs text-gray-400 font-semibold">Accuracy</p>
            <p class="text-[10px] text-gray-500">RMSE: ~43mm (Good)</p>
          </div>
        </div>
      </div>
    </section>

    <!-- SEARCH SECTION -->
    <div class="flex justify-center mb-12">
      <div class="relative w-full max-w-md">
        <input type="text" id="districtSearch"
          class="w-full px-6 py-4 rounded-full bg-slate-800 border-2 border-blue-500 text-white placeholder-gray-400 focus:outline-none focus:ring-4 focus:ring-blue-500/30 text-lg transition shadow-lg"
          placeholder="Enter District Name (e.g., Wakiso)..." onkeyup="handleEnter(event)">
        <button onclick="searchDistrict()"
          class="absolute right-2 top-2 bottom-2 px-6 bg-blue-600 hover:bg-blue-500 text-white rounded-full font-semibold transition">
          Search
        </button>
      </div>
    </div>

    <!-- ERROR MESSAGE -->
    <div id="errorMessage"
      class="hidden max-w-3xl mx-auto p-6 bg-red-900/50 border border-red-500 rounded-xl text-center text-red-200 shadow-2xl backdrop-blur-md">
      <div class="flex flex-col items-center gap-2">
        <i data-lucide="alert-triangle" class="w-12 h-12 text-red-400"></i>
        <h3 class="text-xl font-bold">District Not Found</h3>
        <p class="text-lg">ERROR!! The district requested isn't among the forecasted districts due to data scarcity, but
          enter any other neighboring district or check the district spelling for confirmation.</p>
      </div>
    </div>

    <!-- DASHBOARD (Hidden initially) -->
    <div id="dashboard" class="hidden animate-fade-in-down flex-grow">

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">

        <!-- 1. INTERACTIVE MAP VISUALIZATION -->
        <div class="glass-panel p-6 flex flex-col min-h-[400px]">
          <div class="flex flex-col items-center justify-center mb-4">
            <h3 class="text-2xl font-bold text-blue-300 mb-1" id="districtNameDisplay">District</h3>
            <p class="text-gray-300 text-sm">Region: <span id="regionDisplay"
                class="font-bold text-white">Central</span></p>
            <p class="text-gray-300 text-sm">Total Forecast: <span id="totalRainDisplay"
                class="font-bold text-blue-300">1200mm</span></p>
          </div>
          <!-- Map Container -->
          <div id="map" class="w-full flex-grow rounded-xl border-2 border-blue-500/30 shadow-inner z-0 relative"></div>
          <p class="text-xs text-center text-gray-500 mt-2 flex items-center justify-center gap-1">
            <i data-lucide="mouse-pointer-2" class="w-3 h-3"></i> Interactive: Zoom & Drag
          </p>
        </div>

        <!-- 2. TREND CHART -->
        <div class="glass-panel p-6 lg:col-span-2">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold text-gray-200 flex items-center gap-2">
              <i data-lucide="trending-up" class="text-blue-400"></i> Forecast Trend (14 Months)
            </h3>
          </div>
          <div class="relative h-[350px] w-full">
            <canvas id="rainfallChart"></canvas>
          </div>
        </div>
      </div>

      <!-- 3. STAKEHOLDER ADVICE -->
      <h3 class="text-2xl font-bold text-center text-blue-200 mb-6 flex items-center justify-center gap-2">
        <i data-lucide="lightbulb" class="text-yellow-400"></i> Recommended Actions
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
        <div class="glass-panel p-6 border-t-4 border-green-500 hover:bg-slate-800 transition">
          <h4 class="text-xl font-bold text-green-100 mb-4 flex items-center gap-2"><i data-lucide="sprout"></i> Farmers
          </h4>
          <ul class="space-y-3 text-gray-300 text-sm list-disc pl-4" id="farmerAdvice"></ul>
        </div>
        <div class="glass-panel p-6 border-t-4 border-yellow-500 hover:bg-slate-800 transition">
          <h4 class="text-xl font-bold text-yellow-100 mb-4 flex items-center gap-2"><i data-lucide="building-2"></i>
            Local Govt</h4>
          <ul class="space-y-3 text-gray-300 text-sm list-disc pl-4" id="govtAdvice"></ul>
        </div>
        <div class="glass-panel p-6 border-t-4 border-red-500 hover:bg-slate-800 transition">
          <h4 class="text-xl font-bold text-red-100 mb-4 flex items-center gap-2"><i data-lucide="siren"></i> Disaster
            Mgmt</h4>
          <ul class="space-y-3 text-gray-300 text-sm list-disc pl-4" id="disasterAdvice"></ul>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <footer class="mt-auto pt-8 border-t border-slate-700 text-center text-gray-400 text-sm">
      <p class="mb-4 max-w-2xl mx-auto">
        <a href="https://github.com/GaiSamuel/MIT_Emerging_Talent_ELO2-Uganda-Districts-Rainfall-Prediction-Using-Machine-Learning"
          target="_blank" class="text-blue-400 hover:underline">
          GaiSamuel/MIT_Emerging_Talent_ELO2-Uganda-Districts-Rainfall-Prediction-Using-Machine-Learning
        </a>:
        This project predicts rainfall for Uganda's districts across the four regions from 2025_10 to 2026_12 to support
        farmers and the communities plan better.
      </p>
      <div class="flex justify-center gap-8 mb-8">
        <div class="flex flex-col items-center">
          <span class="font-bold text-white">Gai Samuel</span>
          <div class="flex gap-2 mt-1">
            <a href="https://github.com/GaiSamuel" target="_blank" class="hover:text-white transition"><i
                data-lucide="github"></i></a>
            <a href="https://linkedin.com/in/samuel-gai" target="_blank" class="hover:text-white transition"><i
                data-lucide="linkedin"></i></a>
          </div>
        </div>
        <div class="flex flex-col items-center">
          <span class="font-bold text-white">Anyak Abraham</span>
          <div class="flex gap-2 mt-1">
            <a href="https://github.com/Anyak7" target="_blank" class="hover:text-white transition"><i
                data-lucide="github"></i></a>
            <a href="https://www.linkedin.com/in/anyak-abraham-b9721a315/" target="_blank"
              class="hover:text-white transition"><i data-lucide="linkedin"></i></a>
          </div>
        </div>
      </div>
    </footer>

  </div>

  <!-- SCRIPT -->
  <script>
    lucide.createIcons();
    function createRain() {
      const container = document.getElementById('rain');
      for (let i = 0; i < 50; i++) {
        const drop = document.createElement('div');
        drop.classList.add('drop');
        drop.style.left = Math.random() * 100 + 'vw';
        drop.style.animationDuration = Math.random() * 1 + 0.5 + 's';
        drop.style.animationDelay = Math.random() * 2 + 's';
        container.appendChild(drop);
      }
    }
    createRain();

    // --- 1. COORDINATE DICTIONARY ---
    const districtLocations = {
      "abim": [2.703, 33.7531], "adjumani": [3.2235, 31.7697], "agago": [2.9102, 33.3461], "alebtong": [2.2667, 33.2557],
      "amolatar": [1.6199, 32.7359], "amudat": [1.8028, 34.8763], "amuria": [2.0079, 33.638], "amuru": [3.0515, 31.9746],
      "apac": [1.8706, 32.4294], "arua": [3.041, 31.0527], "budaka": [1.0597, 33.9886], "bududa": [1.032, 34.4079],
      "bugiri": [0.5313, 33.7745], "bugweri": [0.6268, 33.6056], "buhweju": [-0.3289, 30.3502], "buikwe": [0.3058, 33.0404],
      "bukedea": [1.3623, 34.1243], "bukomansimbi": [-0.1297, 31.6283], "bukwo": [1.2785, 34.6863], "bulambuli": [1.3645, 34.3597],
      "buliisa": [1.9599, 31.3917], "bundibugyo": [0.6956, 30.0562], "bunyangabu": [0.4948, 30.1725], "bushenyi": [-0.4838, 30.1518],
      "busia": [0.4118, 34.0053], "butaleja": [0.8836, 33.9341], "butambala": [0.1537, 32.0747], "butebo": [1.1822, 33.9843],
      "buvuma": [-0.3917, 33.2089], "buyende": [1.2605, 33.1469], "dokolo": [1.9373, 33.0759], "gomba": [0.1957, 31.7027],
      "gulu": [2.9749, 32.3951], "hoima": [1.5819, 31.2139], "ibanda": [-0.0792, 30.4895], "iganga": [0.7272, 33.4789],
      "isingiro": [-0.8532, 30.8777], "jinja": [0.5655, 33.2127], "kaabong": [3.5435, 34.1556], "kabale": [-1.3309, 30.0177],
      "kabarole": [0.636, 30.3346], "kaberamaido": [1.6944, 33.1285], "kagadi": [1.0147, 30.8106], "kakumiro": [0.9846, 31.2984],
      "kalaki": [1.835, 33.3363], "kalangala": [-0.5785, 32.4418], "kaliro": [1.0676, 33.4833], "kalungu": [-0.1021, 31.8027],
      "kampala": [0.3157, 32.597], "kamuli": [0.9371, 33.1075], "kamwenge": [0.3157, 30.5584], "kanungu": [-0.8102, 29.7258],
      "kapchorwa": [1.3445, 34.43], "kapelebyong": [2.2134, 33.7439], "karenga": [3.7281, 33.7882], "kasese": [0.1177, 30.0019],
      "kassanda": [0.5382, 31.7548], "katakwi": [1.9223, 34.0381], "kayunga": [0.9819, 32.8925], "kazo": [0.0415, 30.7924],
      "kibaale": [0.8022, 31.0674], "kiboga": [0.8402, 31.9566], "kibuku": [1.0534, 33.8011], "kikuube": [1.308, 30.9502],
      "kiruhura": [-0.3497, 30.9149], "kiryandongo": [2.023, 32.0408], "kisoro": [-1.2173, 29.6802], "kitagwenda": [0.0122, 30.3411],
      "kitgum": [3.398, 33.2581], "koboko": [3.5256, 31.008], "kole": [2.2915, 32.7663], "kotido": [3.0241, 33.9881],
      "kumi": [1.4736, 33.9614], "kwania": [1.9168, 32.7342], "kween": [1.4366, 34.5695], "kyankwanzi": [1.1214, 31.6416],
      "kyegegwa": [0.4507, 31.0021], "kyenjojo": [0.6563, 30.6624], "kyotera": [-0.8057, 31.6604], "lamwo": [3.5506, 32.7239],
      "lira": [2.3036, 32.9634], "luuka": [0.8039, 33.3385], "luwero": [0.829, 32.5833], "lwengo": [-0.4134, 31.4259],
      "lyantonde": [-0.2231, 31.1881], "madi okollo": [2.8532, 31.2312], "manafwa": [0.8751, 34.2709], "maracha": [3.2369, 30.9269],
      "masaka": [-0.4913, 31.8556], "masindi": [1.7439, 31.7123], "mayuge": [-0.0885, 33.5518], "mbale": [1.0192, 34.1984],
      "mbarara": [-0.4933, 30.6063], "mitooma": [-0.6243, 30.0225], "mityana": [0.4433, 32.0596], "moroto": [2.6488, 34.6316],
      "moyo": [3.6428, 31.7659], "mpigi": [0.067, 32.159], "mubende": [0.504, 31.3791], "mukono": [0.2756, 32.7735],
      "nabilatuk": [2.024, 34.5032], "nakapiripirit": [1.781, 34.608], "nakaseke": [1.0488, 32.1692], "nakasongola": [1.352, 32.4256],
      "namayingo": [-0.3174, 33.8046], "namisindwa": [0.8766, 34.3728], "namutumba": [0.8687, 33.6817], "napak": [2.3923, 34.2638],
      "nebbi": [2.4302, 31.1774], "ngora": [1.4964, 33.7544], "ntoroko": [1.0105, 30.3632], "ntungamo": [-0.9421, 30.2722],
      "nwoya": [2.5284, 31.8374], "obongi": [3.392, 31.5568], "omoro": [2.6676, 32.4682], "otuke": [2.4749, 33.3826], "oyam": [2.3722, 32.4844], "pader": [2.9294, 32.8675], "pakwach": [2.4932, 31.3702], "pallisa": [1.2315, 33.6753], "rakai": [-0.707, 31.3037], "rubanda": [-1.1711, 29.866], "rubirizi": [-0.2602, 29.9924], "rukiga": [-1.1505, 30.0913], "rukungiri": [-0.7059, 29.889], "rwampara": [-0.7464, 30.4935], "serere": [1.4881, 33.3724], "sheema": [-0.6036, 30.3266], "sironko": [1.1716, 34.3187], "soroti": [1.7711, 33.5909], "ssembabule": [-0.0265, 31.3399], "terego": [3.18, 31.05], "tororo": [0.725, 34.0822], "wakiso": [0.2204, 32.446], "yumbe": [3.5206, 31.2887], "zombo": [2.5187, 30.8954]
    };

    // --- 2. FORECAST DATA ---
    const rawForecasts = {
      "abim": [62.4, 18.4, 9.2, 27.3, 62.0, 149.1, 166.9, 119.1, 148.5, 154.1, 98.7, 111.0, 59.7, 23.7],
      "adjumani": [118.3, 38.9, 16.6, 29.1, 63.0, 129.7, 150.7, 135.1, 146.0, 183.7, 147.5, 156.7, 99.1, 41.0],
      "agago": [73.0, 17.9, 9.6, 26.9, 68.7, 154.9, 193.7, 141.0, 153.8, 175.6, 118.9, 131.8, 70.6, 25.7],
      "alebtong": [97.8, 19.5, 31.6, 62.8, 87.1, 154.3, 210.6, 137.1, 164.2, 198.7, 145.4, 147.5, 82.2, 27.9],
      "amolatar": [107.4, 87.0, 47.6, 113.6, 133.9, 185.1, 201.0, 106.1, 104.8, 163.4, 167.8, 158.9, 113.1, 83.7],
      "amudat": [58.8, 20.9, 10.3, 21.2, 50.3, 107.4, 96.5, 64.8, 124.5, 122.2, 86.9, 91.8, 47.0, 23.8],
      "amuru": [137.8, 50.4, 16.4, 30.0, 85.7, 151.5, 162.2, 119.3, 128.3, 173.4, 153.3, 160.8, 111.6, 53.1],
      "apac": [107.8, 85.8, 31.8, 73.7, 117.7, 168.7, 207.4, 113.0, 102.4, 151.9, 175.6, 155.8, 116.3, 86.4],
      "arua": [110.8, 22.2, 8.1, 31.0, 87.5, 131.9, 123.4, 97.7, 137.3, 169.8, 168.1, 178.6, 110.4, 22.6],
      "budaka": [136.0, 79.4, 40.7, 86.8, 110.5, 209.3, 208.7, 155.7, 148.7, 162.5, 157.2, 164.5, 134.8, 86.7],
      "bugiri": [145.3, 143.1, 82.3, 101.3, 183.1, 237.8, 245.5, 96.4, 73.4, 117.2, 140.0, 156.2, 129.4, 143.8],
      "buhweju": [140.7, 101.2, 49.6, 55.8, 169.5, 148.2, 109.7, 74.1, 52.9, 115.0, 139.0, 127.9, 115.7, 118.6],
      "buikwe": [166.9, 135.3, 84.1, 92.2, 189.2, 247.1, 226.1, 85.3, 77.4, 117.7, 142.2, 189.8, 209.0, 130.4],
      "bukedea": [95.2, 60.9, 29.0, 55.9, 100.6, 199.0, 228.3, 119.6, 152.6, 155.4, 153.2, 158.3, 88.5, 79.6],
      "bukwo": [130.7, 49.4, 35.0, 58.6, 87.8, 162.3, 191.9, 145.5, 193.4, 165.4, 129.3, 171.4, 117.0, 46.1],
      "bulambuli": [104.1, 18.1, 27.7, 34.4, 77.9, 173.3, 214.2, 136.8, 154.7, 174.0, 159.3, 175.1, 89.3, 19.5],
      "buliisa": [5.9, 44.4, 45.9, 65.2, 76.4, 138.0, 138.1, 108.4, 121.1, 142.5, 149.1, 197.0, 152.7, 45.5],
      "bundibugyo": [155.6, 107.5, 61.2, 61.0, 157.4, 189.1, 135.4, 98.3, 117.8, 147.8, 155.0, 203.1, 144.5, 108.0],
      "bunyangabu": [165.5, 105.3, 60.3, 61.7, 162.6, 185.1, 124.3, 63.3, 48.5, 125.4, 162.7, 207.0, 160.5, 107.3],
      "bushenyi": [150.5, 119.7, 63.3, 61.4, 170.0, 136.9, 105.3, 41.2, 30.7, 94.1, 141.0, 146.3, 143.2, 122.2],
      "busia": [160.6, 140.8, 76.6, 85.4, 180.5, 241.7, 260.3, 116.3, 86.2, 117.8, 149.9, 156.9, 125.5, 140.2],
      "butambala": [169.1, 120.7, 76.3, 83.2, 172.2, 195.8, 174.1, 76.8, 56.0, 114.3, 125.5, 174.1, 189.5, 116.7],
      "buvuma": [113.8, 158.5, 82.7, 94.8, 187.2, 253.4, 236.0, 105.0, 63.7, 108.7, 119.4, 119.6, 112.3, 147.9],
      "buyende": [107.9, 83.7, 92.5, 87.9, 169.1, 240.2, 252.8, 103.5, 106.7, 165.9, 162.7, 169.0, 119.4, 50.5],
      "dokolo": [159.4, 64.6, 28.9, 71.1, 102.2, 177.9, 210.3, 114.2, 138.4, 172.3, 175.7, 148.6, 106.1, 85.1],
      "gomba": [139.4, 101.3, 55.2, 51.2, 161.1, 163.7, 144.6, 56.4, 48.8, 116.5, 131.6, 149.4, 135.7, 104.3],
      "gulu": [140.7, 35.4, 14.0, 36.0, 75.6, 137.2, 168.5, 131.7, 144.2, 189.6, 160.9, 145.4, 96.6, 41.3],
      "hoima": [148.5, 48.9, 61.3, 62.5, 138.4, 210.8, 178.1, 109.5, 119.2, 156.9, 154.9, 233.1, 186.9, 54.9],
      "ibanda": [115.7, 120.1, 59.6, 53.9, 164.3, 140.8, 88.0, 38.9, 42.0, 82.7, 127.1, 146.1, 112.6, 120.6],
      "iganga": [145.4, 82.5, 106.3, 125.8, 185.5, 236.3, 245.6, 117.1, 126.8, 174.6, 162.8, 202.6, 157.5, 86.6],
      "isingiro": [126.4, 106.1, 61.3, 57.4, 162.4, 140.5, 93.6, 30.0, 42.6, 72.7, 118.2, 125.7, 110.4, 119.4],
      "jinja": [188.8, 133.6, 89.2, 93.7, 181.4, 254.0, 243.8, 94.0, 101.8, 138.6, 153.5, 195.0, 221.6, 136.9],
      "kaabong": [43.8, 25.7, 10.2, 20.9, 51.7, 104.6, 103.4, 78.9, 104.2, 84.9, 49.9, 68.7, 37.2, 41.6],
      "kabale": [148.5, 109.1, 65.1, 72.4, 163.0, 152.8, 118.1, 24.9, 23.7, 62.9, 108.7, 129.5, 136.3, 107.8],
      "kaberamaido": [137.5, 47.8, 32.0, 84.8, 127.1, 187.5, 201.1, 103.6, 116.5, 150.0, 160.3, 152.4, 109.3, 85.7],
      "kagadi": [125.8, 112.3, 57.4, 52.9, 157.2, 195.1, 199.9, 108.4, 117.4, 125.0, 133.7, 202.0, 157.5, 108.7],
      "kakumiro": [113.3, 115.0, 56.6, 56.6, 161.5, 195.8, 192.3, 108.5, 63.1, 119.6, 140.1, 163.4, 120.5, 115.3],
      "kalaki": [110.5, 38.5, 10.5, 35.4, 120.5, 170.2, 155.4, 110.2, 115.4, 130.2, 145.4, 135.2, 112.5, 42.5],
      "kalangala": [117.5, 140.4, 86.4, 89.0, 185.8, 261.8, 257.6, 140.9, 66.1, 100.1, 117.1, 124.6, 110.7, 140.0],
      "kaliro": [121.5, 52.1, 74.6, 98.0, 172.6, 228.7, 248.0, 134.0, 138.7, 182.0, 167.1, 176.0, 138.2, 49.5],
      "kalungu": [122.0, 118.0, 70.0, 71.1, 191.9, 176.3, 165.1, 65.1, 33.4, 78.3, 110.2, 142.3, 125.0, 117.9],
      "kamuli": [158.7, 112.1, 83.1, 92.5, 176.6, 233.4, 241.7, 93.3, 83.9, 135.6, 166.6, 218.3, 168.0, 110.5],
      "kamwenge": [133.8, 93.1, 48.3, 50.8, 153.7, 172.1, 102.9, 51.9, 37.9, 113.0, 133.4, 157.2, 121.1, 107.3],
      "kanungu": [153.2, 106.2, 63.8, 64.4, 166.8, 150.1, 129.6, 79.3, 63.9, 126.0, 147.0, 177.6, 152.9, 106.2],
      "kapchorwa": [202.8, 61.7, 43.0, 44.9, 108.0, 248.5, 217.4, 187.9, 201.7, 211.2, 132.1, 232.5, 202.6, 60.3],
      "kapelebyong": [92.5, 18.0, 30.2, 59.2, 87.1, 144.8, 218.0, 145.2, 158.4, 183.1, 126.2, 136.2, 82.0, 25.9],
      "karenga": [50.0, 22.9, 10.0, 24.7, 56.3, 109.8, 99.2, 86.4, 125.0, 120.6, 82.7, 67.6, 50.7, 33.2],
      "kasese": [142.4, 108.1, 59.4, 56.3, 156.5, 158.1, 132.9, 73.6, 57.6, 98.5, 127.7, 166.9, 144.7, 109.0],
      "kassanda": [131.7, 102.9, 57.5, 54.4, 173.3, 179.0, 145.3, 58.6, 50.3, 119.8, 136.7, 170.8, 146.7, 99.2],
      "katakwi": [110.5, 34.8, 25.9, 60.0, 88.5, 183.5, 229.1, 138.2, 169.2, 188.9, 127.7, 152.8, 86.0, 46.4],
      "kayunga": [180.4, 129.1, 53.2, 122.1, 184.8, 235.6, 230.0, 103.3, 75.4, 130.1, 157.7, 196.6, 206.4, 120.5],
      "kazo": [117.4, 115.4, 57.1, 53.6, 151.5, 138.8, 96.2, 35.9, 44.6, 90.1, 120.0, 153.4, 121.9, 109.6],
      "kibaale": [125.7, 102.9, 52.0, 50.5, 155.6, 151.8, 147.1, 50.7, 57.9, 123.4, 147.6, 193.4, 145.6, 99.1],
      "kiboga": [123.4, 113.4, 65.5, 61.7, 167.5, 216.9, 210.7, 93.0, 61.0, 117.0, 137.6, 178.6, 161.0, 101.9],
      "kibuku": [127.8, 54.8, 107.4, 126.0, 175.6, 237.2, 250.7, 123.2, 109.5, 154.7, 153.3, 135.8, 102.3, 108.5],
      "kikuube": [118.4, 95.5, 47.6, 65.3, 155.4, 214.5, 207.0, 117.1, 131.5, 163.0, 162.0, 233.8, 168.9, 60.3],
      "kiruhura": [116.5, 115.0, 57.3, 52.0, 150.8, 143.6, 96.0, 36.2, 46.8, 83.0, 125.3, 156.4, 122.2, 108.7],
      "kiryandongo": [121.3, 70.8, 30.5, 64.5, 97.6, 155.7, 171.8, 111.2, 126.7, 160.2, 151.0, 158.8, 115.8, 75.5],
      "kisoro": [172.8, 119.8, 74.6, 101.7, 152.4, 162.7, 130.0, 38.7, 19.2, 87.2, 140.9, 157.3, 171.0, 119.6],
      "kitagwenda": [131.2, 88.7, 39.9, 57.8, 162.8, 169.2, 164.5, 110.9, 112.9, 142.2, 143.2, 181.6, 126.9, 89.1],
      "kitgum": [81.3, 15.5, 9.7, 27.3, 67.5, 152.6, 182.5, 136.8, 159.0, 176.6, 113.3, 143.0, 81.2, 20.2],
      "koboko": [109.5, 47.1, 11.5, 28.9, 107.6, 146.2, 182.3, 106.8, 114.6, 124.5, 149.8, 153.5, 106.1, 56.6],
      "kole": [161.4, 68.8, 22.1, 52.4, 97.5, 164.2, 224.3, 143.6, 144.8, 185.3, 160.5, 161.7, 113.0, 71.3],
      "kotido": [46.0, 18.6, 7.6, 22.0, 49.7, 114.7, 92.6, 80.9, 123.8, 113.7, 75.7, 67.3, 41.5, 41.3],
      "kumi": [89.7, 47.5, 35.6, 66.4, 90.9, 177.4, 224.0, 111.4, 168.2, 180.5, 133.2, 168.7, 88.4, 59.2],
      "kwania": [139.2, 70.9, 30.0, 69.9, 103.5, 168.1, 214.5, 132.4, 136.9, 179.9, 163.6, 156.7, 111.7, 79.0],
      "kween": [88.9, 34.0, 26.5, 30.0, 69.7, 169.0, 132.1, 89.7, 121.3, 134.1, 125.8, 133.8, 76.1, 33.2],
      "kyankwanzi": [111.1, 94.1, 38.6, 68.4, 158.2, 211.6, 233.1, 121.3, 84.0, 125.5, 150.6, 210.3, 162.6, 73.5],
      "kyegegwa": [124.3, 98.7, 49.5, 50.3, 153.4, 150.7, 105.9, 44.3, 41.4, 109.2, 125.8, 153.3, 121.2, 104.5],
      "kyenjojo": [137.6, 96.5, 52.2, 50.6, 160.5, 167.9, 106.9, 64.2, 78.4, 136.2, 166.1, 207.7, 140.4, 97.8],
      "kyotera": [115.3, 132.7, 69.4, 77.3, 169.3, 166.9, 184.8, 74.2, 40.4, 77.0, 116.7, 131.2, 101.2, 132.7],
      "lamwo": [98.4, 15.6, 7.6, 28.4, 75.1, 134.1, 162.9, 147.5, 177.1, 188.7, 131.6, 153.7, 88.1, 19.1],
      "lira": [109.5, 51.9, 15.8, 65.6, 86.2, 158.2, 214.7, 142.0, 153.1, 186.6, 148.1, 153.4, 86.1, 63.5],
      "luuka": [202.5, 125.6, 51.8, 125.1, 189.2, 243.1, 246.5, 103.4, 113.6, 171.3, 146.6, 200.0, 214.3, 128.3],
      "luwero": [176.0, 122.4, 48.8, 98.2, 179.6, 209.2, 205.9, 112.5, 80.7, 125.0, 144.3, 189.4, 185.0, 119.4],
      "lwengo": [118.3, 117.3, 64.2, 63.2, 177.6, 159.3, 148.2, 48.4, 27.2, 78.9, 123.2, 136.5, 111.3, 119.0],
      "lyantonde": [107.3, 118.4, 60.8, 53.3, 159.6, 148.6, 125.1, 33.3, 36.5, 82.3, 123.7, 154.7, 127.1, 108.9],
      "madi okollo": [104.4, 45.4, 12.8, 28.2, 66.3, 117.6, 128.0, 109.4, 125.9, 163.2, 147.4, 155.7, 103.3, 44.5],
      "manafwa": [140.2, 58.5, 24.5, 53.2, 145.5, 195.2, 170.4, 115.2, 130.4, 145.2, 160.6, 150.2, 130.4, 55.2],
      "maracha": [119.8, 21.9, 8.0, 29.3, 102.4, 142.2, 173.6, 119.8, 144.7, 168.7, 176.5, 183.9, 114.5, 21.4],
      "masaka": [114.6, 139.2, 85.2, 82.5, 176.1, 255.2, 249.3, 132.6, 62.4, 79.0, 116.5, 136.1, 112.2, 137.5],
      "masindi": [106.3, 82.1, 34.3, 70.9, 121.5, 196.2, 191.6, 109.3, 139.9, 182.0, 161.1, 204.5, 154.8, 67.5],
      "mayuge": [149.8, 147.2, 83.3, 95.6, 188.3, 252.8, 239.9, 95.3, 97.4, 134.7, 164.8, 182.8, 178.0, 129.6],
      "mbale": [173.6, 111.5, 74.5, 73.1, 144.3, 229.3, 204.4, 154.9, 154.4, 178.5, 163.8, 212.5, 167.4, 112.0],
      "mbarara": [129.7, 106.5, 61.7, 57.9, 162.7, 140.4, 88.9, 28.1, 43.0, 73.6, 122.9, 133.6, 120.2, 117.8],
      "mitooma": [151.4, 127.7, 62.1, 60.4, 176.7, 154.0, 126.7, 74.5, 50.6, 128.2, 148.8, 178.0, 147.7, 127.5],
      "mityana": [166.8, 103.9, 65.7, 70.1, 191.1, 198.2, 184.6, 68.7, 52.0, 112.1, 118.4, 161.9, 167.8, 105.4],
      "moroto": [38.0, 19.3, 8.3, 19.4, 48.9, 104.0, 93.4, 73.1, 122.8, 89.1, 61.5, 67.6, 36.7, 43.5],
      "moyo": [97.6, 42.0, 18.5, 27.2, 60.4, 124.5, 138.6, 133.0, 152.0, 179.5, 137.3, 158.9, 90.2, 46.0],
      "mpigi": [125.7, 121.0, 73.9, 70.6, 192.6, 208.2, 221.5, 77.0, 47.0, 92.3, 119.7, 153.5, 133.0, 121.4],
      "mubende": [136.0, 98.3, 51.5, 51.5, 155.1, 156.8, 134.8, 51.8, 52.9, 122.0, 136.7, 174.9, 136.5, 98.8],
      "mukono": [170.8, 132.9, 84.1, 92.7, 184.5, 249.3, 220.1, 86.8, 65.9, 117.9, 145.8, 188.7, 211.8, 125.7],
      "nabilatuk": [88.1, 17.9, 9.2, 27.8, 58.8, 161.5, 188.2, 129.5, 135.7, 149.7, 115.6, 140.3, 66.5, 25.9],
      "nakapiripirit": [62.1, 20.3, 12.2, 27.8, 63.0, 133.9, 114.0, 82.5, 135.2, 152.0, 105.7, 115.0, 51.1, 27.8],
      "nakaseke": [103.7, 108.2, 43.4, 88.1, 157.7, 220.9, 216.9, 85.3, 78.0, 126.7, 158.8, 184.3, 158.1, 79.5],
      "nakasongola": [109.5, 98.3, 40.6, 73.1, 131.6, 216.1, 230.2, 116.8, 75.9, 124.7, 152.3, 157.9, 112.7, 93.6],
      "namayingo": [109.5, 155.0, 82.1, 91.1, 182.6, 254.0, 240.0, 103.4, 143.3, 157.7, 163.9, 159.7, 132.2, 140.0],
      "namutumba": [141.4, 54.5, 127.5, 125.4, 182.4, 240.9, 251.1, 91.3, 68.9, 121.6, 132.8, 178.5, 144.3, 54.4],
      "napak": [51.6, 19.4, 8.5, 25.9, 58.8, 129.1, 142.7, 105.5, 154.4, 142.7, 84.4, 103.4, 48.8, 25.1],
      "nebbi": [108.2, 57.5, 20.0, 47.6, 74.1, 132.7, 113.1, 79.9, 91.2, 121.9, 132.5, 158.7, 114.0, 57.0],
      "ngora": [121.4, 74.8, 28.4, 71.1, 114.3, 196.2, 225.0, 142.0, 158.4, 194.6, 150.8, 140.8, 100.6, 98.4],
      "ntoroko": [102.0, 92.0, 37.7, 36.6, 135.7, 168.4, 166.2, 119.1, 154.0, 183.9, 168.3, 232.7, 168.2, 80.6],
      "ntungamo": [131.8, 113.4, 63.2, 62.7, 165.3, 137.9, 89.0, 22.7, 37.0, 66.5, 110.4, 129.3, 121.8, 113.9],
      "nwoya": [151.7, 56.5, 24.2, 47.8, 87.9, 154.2, 162.1, 120.2, 137.3, 179.0, 151.0, 167.7, 123.8, 58.0],
      "obongi": [90.2, 26.5, 24.4, 30.2, 70.4, 123.2, 148.4, 140.8, 151.9, 173.3, 141.8, 147.9, 87.2, 30.0],
      "omoro": [119.9, 57.4, 20.0, 61.6, 87.6, 156.5, 202.3, 129.5, 134.3, 184.1, 154.6, 164.8, 109.6, 63.9],
      "otuke": [78.7, 18.1, 17.2, 46.6, 82.8, 136.4, 187.5, 151.0, 160.2, 181.2, 127.3, 135.1, 81.1, 26.8],
      "oyam": [157.0, 64.9, 21.9, 55.7, 89.9, 164.7, 220.5, 138.2, 138.6, 185.0, 153.8, 163.2, 113.5, 66.8],
      "pader": [99.9, 31.8, 30.1, 57.5, 89.6, 140.5, 176.8, 140.9, 168.4, 185.6, 139.2, 143.2, 90.6, 42.2],
      "pallisa": [116.1, 47.1, 44.7, 81.2, 145.2, 233.5, 260.6, 116.1, 149.0, 174.2, 162.6, 165.6, 106.2, 62.7],
      "rakai": [138.9, 107.8, 65.9, 65.6, 174.3, 148.7, 155.8, 37.0, 19.5, 69.7, 113.9, 136.7, 131.0, 113.0],
      "rubanda": [120.5, 45.2, 15.6, 42.1, 130.5, 180.2, 165.4, 110.2, 125.4, 140.2, 155.6, 145.2, 125.4, 50.2],
      "rubirizi": [156.1, 104.6, 47.2, 58.4, 155.4, 194.6, 140.9, 129.2, 136.1, 150.9, 143.6, 212.7, 156.5, 106.2],
      "rukiga": [115.4, 40.2, 12.5, 38.5, 125.4, 175.2, 160.5, 115.4, 120.5, 135.4, 150.2, 140.5, 118.5, 45.2],
      "rukungiri": [144.8, 113.9, 63.1, 61.5, 168.4, 142.6, 106.4, 60.4, 36.4, 104.5, 134.1, 156.2, 140.0, 112.9],
      "rwampara": [134.4, 107.9, 63.2, 62.7, 161.6, 138.4, 87.9, 30.5, 41.6, 74.3, 126.1, 125.1, 119.1, 116.8],
      "serere": [127.7, 42.4, 32.1, 78.4, 128.7, 190.4, 206.6, 110.4, 123.7, 164.0, 158.2, 141.2, 97.8, 87.6],
      "sheema": [115.4, 40.2, 12.5, 38.5, 125.4, 175.2, 160.5, 115.4, 120.5, 135.4, 150.2, 140.5, 118.5, 45.2],
      "sironko": [122.0, 93.0, 41.1, 40.8, 107.4, 178.9, 202.6, 185.1, 172.4, 199.0, 191.4, 213.6, 126.5, 92.3],
      "soroti": [160.3, 61.8, 24.0, 60.1, 95.3, 185.9, 231.0, 143.8, 160.4, 185.3, 147.3, 155.8, 106.3, 74.0],
      "ssembabule": [114.6, 117.7, 58.9, 51.2, 160.6, 155.8, 136.3, 44.9, 30.5, 90.4, 120.3, 151.3, 118.2, 116.3],
      "terego": [105.4, 35.2, 9.5, 32.5, 115.4, 165.2, 150.5, 105.4, 110.5, 125.4, 140.2, 130.5, 108.5, 38.5],
      "tororo": [153.3, 108.0, 49.7, 73.2, 119.3, 239.6, 239.9, 138.3, 142.5, 152.1, 149.0, 171.0, 137.9, 109.0],
      "wakiso": [154.5, 133.8, 77.5, 79.1, 173.1, 220.7, 203.5, 85.4, 53.9, 113.9, 131.3, 157.3, 179.9, 127.3],
      "yumbe": [104.3, 26.6, 6.2, 29.4, 76.9, 127.6, 145.2, 125.2, 128.0, 155.5, 153.5, 161.9, 92.9, 26.2],
      "zombo": [155.0, 29.3, 10.2, 28.9, 130.3, 137.3, 94.3, 57.4, 103.1, 141.1, 147.4, 165.6, 105.9, 29.8]
    };

    const dates = ["Nov 25", "Dec 25", "Jan 26", "Feb 26", "Mar 26", "Apr 26", "May 26", "Jun 26", "Jul 26", "Aug 26", "Sep 26", "Oct 26", "Nov 26", "Dec 26"];

    const districtRegions = {
      "abim": "Northern", "adjumani": "Northern", "agago": "Northern", "alebtong": "Northern", "amolatar": "Northern", "amudat": "Northern",
      "amuru": "Northern", "apac": "Northern", "arua": "Northern", "budaka": "Eastern", "bugiri": "Eastern", "buhweju": "Western",
      "buikwe": "Central", "bukedea": "Eastern", "bukwo": "Eastern", "bulambuli": "Eastern", "buliisa": "Western", "bundibugyo": "Western",
      "bunyangabu": "Western", "bushenyi": "Western", "busia": "Eastern", "butambala": "Central", "buvuma": "Central", "buyende": "Eastern",
      "dokolo": "Northern", "gomba": "Central", "gulu": "Northern", "hoima": "Western", "ibanda": "Western", "iganga": "Eastern",
      "isingiro": "Western", "jinja": "Eastern", "kaabong": "Northern", "kabale": "Western", "kaberamaido": "Eastern", "kagadi": "Western",
      "kakumiro": "Western", "kalaki": "Eastern", "kalangala": "Central", "kaliro": "Eastern", "kalungu": "Central", "kamuli": "Eastern",
      "kamwenge": "Western", "kanungu": "Western", "kapchorwa": "Eastern", "kapelebyong": "Eastern", "karenga": "Northern", "kasese": "Western",
      "kassanda": "Central", "katakwi": "Eastern", "kayunga": "Central", "kazo": "Western", "kibaale": "Western", "kiboga": "Central",
      "kibuku": "Eastern", "kikuube": "Western", "kiruhura": "Western", "kiryandongo": "Western", "kisoro": "Western", "kitagwenda": "Western",
      "kitgum": "Northern", "koboko": "Northern", "kole": "Northern", "kotido": "Northern", "kumi": "Eastern", "kwania": "Northern",
      "kween": "Eastern", "kyankwanzi": "Central", "kyegegwa": "Western", "kyenjojo": "Western", "kyotera": "Central", "lamwo": "Northern",
      "lira": "Northern", "luuka": "Eastern", "luwero": "Central", "lwengo": "Central", "lyantonde": "Central", "madi okollo": "Northern",
      "manafwa": "Eastern", "maracha": "Northern", "masaka": "Central", "masindi": "Western", "mayuge": "Eastern", "mbale": "Eastern",
      "mbarara": "Western", "mitooma": "Western", "mityana": "Central", "moroto": "Northern", "moyo": "Northern", "mpigi": "Central",
      "mubende": "Central", "mukono": "Central", "nabilatuk": "Northern", "nakapiripirit": "Northern", "nakaseke": "Central",
      "nakasongola": "Central", "namayingo": "Eastern", "namutumba": "Eastern", "napak": "Northern", "nebbi": "Northern", "ngora": "Eastern",
      "ntoroko": "Western", "ntungamo": "Western", "nwoya": "Northern", "obongi": "Northern", "omoro": "Northern", "otuke": "Northern",
      "oyam": "Northern", "pader": "Northern", "pallisa": "Eastern", "rakai": "Central", "rubanda": "Western", "rubirizi": "Western",
      "rukiga": "Western", "rukungiri": "Western", "rwampara": "Western", "serere": "Eastern", "sheema": "Western", "sironko": "Eastern",
      "soroti": "Eastern", "ssembabule": "Central", "terego": "Northern", "tororo": "Eastern", "wakiso": "Central", "yumbe": "Northern", "zombo": "Northern"
    };

    const adviceLibrary = {
      "High": {
        farmers: ["âš ï¸ Delay planting beans in low-lying areas (rot risk).", "âœ… Dig drainage channels immediately.", "ðŸŒ¾ Plant water-tolerant crops like Rice or Yams."],
        govt: ["ðŸšœ Deploy road maintenance units to flood-prone zones.", "ðŸ“¢ Issue flood warnings via local radio.", "ðŸ’Š Stockpile cholera kits in health centers."],
        disaster: ["ðŸ†˜ Pre-position relief items in safe zones.", "ðŸ—ºï¸ Update evacuation maps for wetland communities.", "ðŸš¤ Inspect rescue boats and equipment."]
      },
      "Moderate": {
        farmers: ["âœ… Standard planting season.", "ðŸŒ½ Good conditions for Maize and Millet.", "ðŸ’§ Practice mulching to retain soil moisture."],
        govt: ["ðŸ“¢ Distribute standard agricultural inputs.", "ðŸ›£ï¸ Routine road maintenance.", "ðŸ“‰ Monitor markets for food price stability."],
        disaster: ["ðŸ‘€ Monitor river levels weekly.", "ðŸ“¢ Sensitize communities on sanitation.", "âœ… Review district contingency plans."]
      },
      "Low": {
        farmers: ["ðŸŒµ Plant drought-resistant crops (Cassava, Sorghum).", "ðŸ’§ Implement drip irrigation where possible.", "ðŸ„ Stockpile feed for livestock."],
        govt: ["ðŸšš Prepare food relief buffers.", "ðŸ’§ Repair community boreholes.", "ðŸ’° Subsidize drought-resistant seeds."],
        disaster: ["ðŸ”¥ Activate drought early warning protocols.", "ðŸš› Plan water trucking routes.", "ðŸ¥ Surveillance for malnutrition cases."]
      }
    };

    // --- MAP VARIABLES ---
    let myChart = null;
    let map = null;
    let mapMarker = null;

    function handleEnter(e) {
      if (e.key === 'Enter') searchDistrict();
    }

    function searchDistrict() {
      const input = document.getElementById('districtSearch').value.toLowerCase().trim();
      const dashboard = document.getElementById('dashboard');
      const errorMsg = document.getElementById('errorMessage');

      dashboard.classList.add('hidden');
      errorMsg.classList.add('hidden');

      if (rawForecasts[input] && districtLocations[input]) {
        // SUCCESS: Show Dashboard
        const values = rawForecasts[input];
        const region = districtRegions[input] || "Unknown";

        // Determine Risk Level dynamically based on total rainfall
        const totalRain = values.reduce((a, b) => a + b, 0);
        let riskLevel = "Moderate";
        if (totalRain > 2000) riskLevel = "High";
        if (totalRain < 1000) riskLevel = "Low";

        // === 1. SHOW CONTAINER FIRST ===
        dashboard.classList.remove('hidden');

        // === 2. THEN RENDER MAP/CHART ===
        renderDashboard(input, { values, region, riskLevel });

        // Scroll to results
        dashboard.scrollIntoView({ behavior: 'smooth', block: 'start' });
      } else {
        // FAILURE: Show specific error message
        errorMsg.classList.remove('hidden');
      }
    }

    function renderDashboard(name, data) {
      // 1. Update Text
      document.getElementById('districtNameDisplay').innerText = name.charAt(0).toUpperCase() + name.slice(1);
      document.getElementById('regionDisplay').innerText = data.region;
      const total = data.values.reduce((a, b) => a + b, 0).toFixed(0);
      document.getElementById('totalRainDisplay').innerText = total + " mm";

      // 2. Initialize Leaflet Map (Interactive)
      // Use the predefined coordinates
      const coords = districtLocations[name];

      if (!map) {
        // Initialize map centered roughly on Uganda, zoom 6 if coords not found (fallback)
        const initialView = coords || [1.3733, 32.2903];
        map = L.map('map', {
          // Re-enabling interactions for usability
          zoomControl: true,
          scrollWheelZoom: true,
          doubleClickZoom: true,
          dragging: true
        }).setView(initialView, 9);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd',
          maxZoom: 19
        }).addTo(map);
      } else {
        if (coords) map.setView(coords, 9);
      }

      // === 3. FORCE REFRESH ===
      // This fixes the "grey box" issue by telling Leaflet to re-check its container size
      setTimeout(() => { map.invalidateSize(); }, 100);

      if (coords) {
        if (mapMarker) map.removeLayer(mapMarker);
        mapMarker = L.marker(coords).addTo(map)
          .bindPopup(`<b>${name.toUpperCase()}</b><br>Forecast: ${total}mm`)
          .openPopup();
      }

      // 3. Render Chart
      const ctx = document.getElementById('rainfallChart').getContext('2d');

      if (myChart) myChart.destroy(); // Clear old chart

      myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Forecast Rainfall (mm)',
            data: data.values,
            borderColor: '#3b82f6', // Tailwind blue-500
            backgroundColor: 'rgba(59, 130, 246, 0.2)',
            borderWidth: 3,
            pointBackgroundColor: '#fff',
            pointBorderColor: '#3b82f6',
            pointRadius: 5,
            pointHoverRadius: 8,
            fill: true,
            tension: 0.4 // Smooth curves
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(15, 23, 42, 0.9)',
              titleFont: { size: 14 },
              bodyFont: { size: 14 },
              padding: 10,
              callbacks: {
                label: function (context) {
                  return context.parsed.y.toFixed(1) + ' mm Rainfall';
                }
              }
            }
          },
          scales: {
            y: {
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#94a3b8' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#94a3b8' }
            }
          }
        }
      });

      // 4. Update Recommendations
      const advice = adviceLibrary[data.riskLevel];

      const createList = (items) => items.map(item => `<li class="flex items-start gap-2">${item}</li>`).join('');

      document.getElementById('farmerAdvice').innerHTML = createList(advice.farmers);
      document.getElementById('govtAdvice').innerHTML = createList(advice.govt);
      document.getElementById('disasterAdvice').innerHTML = createList(advice.disaster);
    }
  </script>
</body>

</html>
